# ===================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ===================================================================
#
# CRITICAL SECURITY NOTICE:
# - Generate NEW secrets before deployment (see instructions below)
# - NEVER commit this file with real credentials to version control
# - Rotate all credentials immediately if exposed
# - Use environment variable injection in Railway/hosting platform
#
# ===================================================================

# -----------------------------
# Database Configuration
# -----------------------------
# Use Supabase connection pooler for better performance
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?pgbouncer=true
DATABASE_URL="postgresql://postgres:[YOUR_PASSWORD]@[YOUR_HOST]:5432/postgres"

# IMPORTANT: Rotate database credentials if previously exposed
# Create new database user with limited permissions in production

# -----------------------------
# JWT Authentication
# -----------------------------
# Generate a strong random secret (REQUIRED):
# Run: openssl rand -base64 64
JWT_SECRET=""  # MUST BE 64+ characters

# Token expiry (default: 7 days)
JWT_EXPIRY="7d"

# -----------------------------
# Application Configuration
# -----------------------------
# Set to production to disable debug features and stack traces
NODE_ENV="production"

# Port (Railway auto-sets this, don't override)
PORT="3000"

# -----------------------------
# Frontend URL (CORS)
# -----------------------------
# CRITICAL: Set to your actual deployed frontend URL
# Railway example: https://[your-project-name]-frontend.up.railway.app
# This prevents unauthorized cross-origin requests
FRONTEND_URL="https://your-obscure-frontend-url.railway.app"

# -----------------------------
# Security Features
# -----------------------------
# Secret path prefix for URL obscurity (optional but recommended)
# Change this annually or if compromised
# Example: /family-tree-2024 or /xyz789abc
SECRET_PATH_PREFIX="/your-secret-path-2024"

# -----------------------------
# Admin Alerts (Email)
# -----------------------------
# Admin recipient for security/activity alerts
ADMIN_ALERT_EMAIL=""

# SMTP configuration for sending emails
SMTP_HOST=""
SMTP_PORT="587"
SMTP_SECURE="false"
SMTP_USER=""
SMTP_PASS=""
SMTP_FROM="Family Tree <no-reply@family-tree.local>"

# Custom header for additional security (optional)
# CUSTOM_FAMILY_HEADER="your-random-secret-key"

# -----------------------------
# Logging Configuration
# -----------------------------
# Set to "error" in production to minimize logging
LOG_LEVEL="error"

# ===================================================================
# DEPLOYMENT CHECKLIST
# ===================================================================
#
# Before deploying to production:
#
# [ ] Generate new JWT_SECRET: openssl rand -base64 64
# [ ] Update DATABASE_URL with production credentials
# [ ] Set FRONTEND_URL to actual deployed frontend
# [ ] Generate random SECRET_PATH_PREFIX
# [ ] Set NODE_ENV=production
# [ ] Update frontend VITE_API_URL with SECRET_PATH_PREFIX
# [ ] Test family password flow end-to-end
# [ ] Verify CORS blocks unauthorized origins
# [ ] Check rate limiting works
# [ ] Set up UptimeRobot monitoring (free)
# [ ] Create first admin user via seed script
# [ ] Change default family password immediately
#
# ===================================================================

# ===================================================================
# RAILWAY.APP DEPLOYMENT NOTES
# ===================================================================
#
# 1. Set environment variables in Railway dashboard (encrypted at rest)
# 2. Railway auto-sets PORT - don't override
# 3. DATABASE_URL can use Railway PostgreSQL or external Supabase
# 4. Frontend deployment:
#    - Deploy as separate service in same project
#    - Set VITE_API_URL to: https://[backend-url]${SECRET_PATH_PREFIX}
# 5. Health check path: /health (configured in railway.toml)
#
# ===================================================================

# ===================================================================
# SECURITY BEST PRACTICES
# ===================================================================
#
# JWT Secret:
#   - Minimum 64 characters (enforced by application)
#   - Generated using cryptographically secure random source
#   - Never reuse across environments
#   - Rotate if compromised
#
# Database:
#   - Use connection pooling (pgbouncer=true)
#   - Create dedicated user with minimal permissions
#   - Enable SSL/TLS connections
#   - Rotate credentials on schedule
#
# URL Obscurity:
#   - Use Railway's random subdomain (don't use custom domain)
#   - Add SECRET_PATH_PREFIX for additional layer
#   - Share URL only with family members
#   - Change prefix if URL leaks
#
# Monitoring:
#   - Set up UptimeRobot (free) for health checks
#   - Review audit logs weekly
#   - Alert on failed authentication attempts
#
# ===================================================================
